
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Finalizar Compra | Alfa Drones</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <img src="images/logo.png" alt="Alfa Drones" class="logo" />
        <nav>
          <a href="https://cezaradts.github.io/alfa-drones/index.html">Início</a>
          <a href="https://cezaradts.github.io/alfa-drones/modelos.html">Modelos</a>
          <a href="https://cezaradts.github.io/alfa-drones-flask/carrinho.html">Carrinho</a>
        </nav>
      </div>
    </header>

    <main>
      <form id="form-compra" method="POST" action="/finalizar_compra">
        <section class="carrinho">
          <h2>Itens no Carrinho</h2>
          <ul id="lista-carrinho"></ul>
          <p id="total"></p>
        </section>

        <section class="finalizar">
          <h2>Finalizar Compra</h2>

          <div id="etapa1">
            <h3>Informações Pessoais</h3>
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" name="nome_completo" required />

            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" name="cpf" required />

            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" name="endereco" required />

            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" required />

            <button type="button" id="btn-avancar">Avançar</button>
          </div>

          <div id="etapa2" style="display: none">
            <h3>Escolha o Método de Pagamento</h3>
            <input type="radio" id="credito" name="pagamento" value="credito" required />
            <label for="credito">Cartão de Crédito</label><br />
            <input type="radio" id="debito" name="pagamento" value="debito" />
            <label for="debito">Cartão de Débito</label><br />
            <input type="radio" id="pix" name="pagamento" value="pix" />
            <label for="pix">PIX</label><br />
            <input type="radio" id="boleto" name="pagamento" value="boleto" />
            <label for="boleto">Boleto Bancário</label><br />
            <button type="button" id="btn-voltar-etapa1">Voltar</button>
            <button type="button" id="btn-selecionar-pagamento">Avançar</button>
          </div>

          <div id="etapa3" style="display: none">
            <h3>Pagamento</h3>
            <div id="detalhes-cartao" style="display: none">
              <label for="numero-cartao">Número do Cartão:</label>
              <input type="text" id="numero-cartao" /><br />
              <label for="nome-cartao">Nome no Cartão:</label>
              <input type="text" id="nome-cartao" /><br />
              <label for="validade-cartao">Validade:</label>
              <input type="text" id="validade-cartao" /><br />
              <label for="cvv-cartao">CVV:</label>
              <input type="text" id="cvv-cartao" /><br />
            </div>

            <div id="detalhes-pix" style="display: none">
              <p>Use o QR Code abaixo para pagar:</p>
              <img src="images/qrcode-ficticio.png" alt="QR Code PIX" />
            </div>

            <div id="detalhes-boleto" style="display: none">
              <p>Clique no botão abaixo para gerar o boleto:</p>
              <button id="btn-gerar-boleto" type="button">Gerar Boleto</button>
            </div>

            <input type="hidden" name="produtos" id="produtos-escondidos" />
            <input type="hidden" name="valor_total" id="valor_total" />

            <button type="button" id="btn-voltar-etapa2">Voltar</button>
            <button type="button" id="btn-finalizar-compra">Finalizar Compra</button>
          </div>
        </section>
      </form>
    </main>

    <footer>
      <p>&copy; 2025 Alfa Drones</p>
    </footer>

    <script>
      const etapa1 = document.getElementById("etapa1");
      const etapa2 = document.getElementById("etapa2");
      const etapa3 = document.getElementById("etapa3");
      const btnAvancar = document.getElementById("btn-avancar");
      const btnSelecionarPagamento = document.getElementById("btn-selecionar-pagamento");
      const btnVoltarEtapa1 = document.getElementById("btn-voltar-etapa1");
      const btnVoltarEtapa2 = document.getElementById("btn-voltar-etapa2");
      const btnFinalizarCompra = document.getElementById("btn-finalizar-compra");
      const detalhesCartao = document.getElementById("detalhes-cartao");
      const detalhesPix = document.getElementById("detalhes-pix");
      const detalhesBoleto = document.getElementById("detalhes-boleto");

      const listaCarrinho = document.getElementById("lista-carrinho");
      const totalElement = document.getElementById("total");
      const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
      let total = 0;

      function atualizarCarrinho() {
        listaCarrinho.innerHTML = "";
        total = 0;

        if (carrinho.length === 0) {
          listaCarrinho.innerHTML = "<li>O carrinho está vazio.</li>";
        } else {
          carrinho.forEach((item, index) => {
            const li = document.createElement("li");
            li.textContent = `${item.modelo} - R$ ${parseFloat(item.preco).toFixed(2).replace(".", ",")}`;
            listaCarrinho.appendChild(li);
            total += parseFloat(item.preco);
          });
        }

        totalElement.textContent = `Total: R$ ${total.toFixed(2).replace(".", ",")}`;
      }

      atualizarCarrinho();

      btnAvancar.addEventListener("click", () => {
        etapa1.style.display = "none";
        etapa2.style.display = "block";
      });

      btnVoltarEtapa1.addEventListener("click", () => {
        etapa2.style.display = "none";
        etapa1.style.display = "block";
      });

      btnSelecionarPagamento.addEventListener("click", () => {
        const metodoPagamento = document.querySelector('input[name="pagamento"]:checked').value;
        etapa2.style.display = "none";
        etapa3.style.display = "block";

        if (metodoPagamento === "credito" || metodoPagamento === "debito") {
          detalhesCartao.style.display = "block";
        } else if (metodoPagamento === "pix") {
          detalhesPix.style.display = "block";
        } else if (metodoPagamento === "boleto") {
          detalhesBoleto.style.display = "block";
        }
      });

      btnVoltarEtapa2.addEventListener("click", () => {
        etapa3.style.display = "none";
        etapa2.style.display = "block";
        detalhesCartao.style.display = "none";
        detalhesPix.style.display = "none";
        detalhesBoleto.style.display = "none";
      });

      document.getElementById("btn-gerar-boleto").addEventListener("click", () => {
        alert("Boleto gerado com sucesso!");
      });

      btnFinalizarCompra.addEventListener("click", () => {
        const produtos = carrinho.map(item => `${item.modelo} - R$ ${item.preco}`);
        document.getElementById("produtos-escondidos").value = JSON.stringify(produtos);
        document.getElementById("valor_total").value = total.toFixed(2);
        localStorage.removeItem("carrinho");
        document.getElementById("form-compra").submit();
      });
    </script>
  </body>
</html>
